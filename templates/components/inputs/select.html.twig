<div id="{{ form.vars.id  }}" tabindex="1" class="relative w-full p-2.5 rounded border-2 border-primary-500 text-primary-500 cursor-pointer hover:focus:border-secondary-500 hover:focus:text-secondary-500">
    {% set name =  form.vars.full_name %}
    {% set type = form.vars.multiple ? 'checkbox' : 'radio' %}
    <div class="flex justify-between items-center">
        <span id="label">{{form.vars.placeholder | default('Séléctionner')}}</span>
        <ion-icon name="chevron-down-outline"></ion-icon>
    </div>
    <ul class="hidden absolute top-full left-0 right-0 max-h-[200px] bg-white shadow-primary-200 shadow rounded z-10 overflow-y-auto">
           {% for item in form.vars.choices %}
           {% set checked = form.vars.multiple ? item.value in form.vars.value : item.value == form.vars.value  %}
            <li class="px-4 py-2 cursor-pointer text-primary-500 flex items-center gap-4">
                <input type="{{type}}" id="{{ form.vars.id ~ "_" ~ loop.index0 }}" name="{{name}}" value="{{ item.value }}" {{ checked ? 'checked' : '' }} class="{{form.vars.multiple ? '' :  'hidden'}}" >
                <label for="{{ form.vars.id ~ "_" ~ loop.index0 }}" class="flex-grow cursor-pointer">  {{ item.label }}</label>
            </li>
        {% endfor %}
    </ul>
</div>
<script>
   
  document.addEventListener('DOMContentLoaded', function(){

    const container = {{ form.vars.id }}
    const inputs  = container.querySelectorAll('input')
    const label = container.querySelector('#label')
    function updateLabel(){
        const checked = container.querySelectorAll('input:checked')
        if (checked.length === 0){
            label.innerText = '{{form.vars.placeholder | default("Séléctionner")}}'
        }else if (checked.length === 1){
            label.innerText = checked[0].nextElementSibling.innerText
        }else{
            label.innerText = checked.length + ' éléments séléctionnés'
        }
    }
    updateLabel()
    
    inputs.forEach(input => {
        input.addEventListener('change', function (){
            updateLabel()
        })
    })
    container.addEventListener('click', function (){
        container.querySelector('ul').classList.toggle('hidden')
    })
    window.addEventListener('click', function (e){
        if (!container.contains(e.target)){
            container.querySelector('ul').classList.add('hidden')
        }
    })
  });
   
</script>